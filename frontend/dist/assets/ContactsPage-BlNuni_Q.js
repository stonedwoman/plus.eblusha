import{d as x,r as d,c as y,u,j as t}from"./vendor-query-CNP5Hy5J.js";import{v as h,I as j,J as g,d as n}from"./index-BSnIWOU2.js";import"./vendor-react-BcTlWpV0.js";import"./vendor-socket-CA1CrNgP.js";import"./vendor-crypto-GGjuBpPe.js";function b(){const s=x(),[i,l]=d.useState("accepted"),p=y({queryKey:["contacts",i],queryFn:async()=>(await n.get("/contacts",{params:{filter:i}})).data.contacts}),r=u({mutationFn:async e=>{await n.post("/contacts/add",{identifier:e})},onSuccess:()=>{s.invalidateQueries({queryKey:["contacts"]})}}),o=u({mutationFn:async e=>{await n.post("/contacts/respond",e)},onSuccess:()=>{s.invalidateQueries({queryKey:["contacts"]})}});d.useEffect(()=>{h();const e=()=>s.invalidateQueries({queryKey:["contacts"]}),a=()=>s.invalidateQueries({queryKey:["contacts"]});j(e),g(a)},[s]);const m=e=>{e.preventDefault();const a=new FormData(e.currentTarget),c=String(a.get("identifier")??"");c&&(r.mutate(c),e.currentTarget.reset())};return t.jsxs("div",{className:"contacts-page",children:[t.jsxs("header",{children:[t.jsx("h2",{children:"Контакты"}),t.jsx("div",{style:{display:"flex",gap:8},children:t.jsxs("select",{value:i,onChange:e=>l(e.target.value),children:[t.jsx("option",{value:"accepted",children:"Друзья"}),t.jsx("option",{value:"incoming",children:"Входящие"}),t.jsx("option",{value:"outgoing",children:"Исходящие"}),t.jsx("option",{value:"all",children:"Все"})]})}),t.jsxs("form",{onSubmit:m,children:[t.jsx("input",{name:"identifier",placeholder:"ID / ник / email",required:!0}),t.jsx("button",{type:"submit",disabled:r.isPending,children:"Добавить"})]})]}),t.jsx("ul",{children:p.data?.map(e=>t.jsxs("li",{style:{display:"flex",gap:12,alignItems:"center"},children:[t.jsx("strong",{style:{minWidth:220},children:e.friend.displayName??e.friend.username}),t.jsx("span",{style:{textTransform:"lowercase"},children:e.status.toLowerCase()}),e.status==="PENDING"&&e.direction==="incoming"&&t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>o.mutate({contactId:e.id,action:"accept"}),children:"Принять"}),t.jsx("button",{onClick:()=>o.mutate({contactId:e.id,action:"reject"}),children:"Отклонить"})]}),e.status==="PENDING"&&e.direction==="outgoing"&&t.jsx("span",{children:"ожидание подтверждения…"}),e.status==="ACCEPTED"&&t.jsx("button",{onClick:async()=>{await n.post("/conversations/with",{userId:e.friend.id}),s.invalidateQueries({queryKey:["conversations"]})},children:"Начать чат"})]},e.id))})]})}export{b as default};
