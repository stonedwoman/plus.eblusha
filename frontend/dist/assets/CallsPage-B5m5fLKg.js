import{r as s,u as v,j as t}from"./vendor-query-D8-W16Rz.js";import{u as x,c as j}from"./index-Imj8oe05.js";import{W as f,a as _}from"./index-CD81hMhF.js";import"./vendor-react-DyfnzrEv.js";import"./vendor-socket-CA1CrNgP.js";import"./vendor-crypto-C7xP7Q7Y.js";const c={};function k(){const r=x(e=>e.session?.user),[o,m]=s.useState("demo-room"),[i,l]=s.useState(null),[n,d]=s.useState(null),u=s.useMemo(()=>c?.VITE_LIVEKIT_URL??n??"ws://eblusha.org:7880",[n]),a=v({mutationFn:async e=>(await j.post("/livekit/token",{room:e.room,participantName:r?.displayName??r?.username??"guest",participantMetadata:{app:"eblusha",userId:r?.id}})).data,onSuccess:e=>{l(e.token),d(e.url)}}),p=e=>{e.preventDefault(),o&&a.mutate({room:o})},h=()=>{l(null)};return t.jsx("div",{className:"calls-page",children:i?u&&t.jsx(f,{serverUrl:u,token:i,connect:!0,video:!0,audio:!0,onDisconnected:h,style:{height:"calc(100vh - 120px)"},children:t.jsx(_,{})}):t.jsxs("form",{onSubmit:p,className:"auth-form",style:{maxWidth:420},children:[t.jsx("h2",{children:"Подключиться к комнате"}),t.jsxs("label",{children:["Комната",t.jsx("input",{name:"room",value:o,onChange:e=>m(e.target.value),placeholder:"room-id",required:!0})]}),t.jsx("button",{type:"submit",disabled:a.isPending,children:a.isPending?"Подключаемся…":"Войти"}),t.jsxs("div",{style:{fontSize:12,color:"var(--text-muted)"},children:["Сервер: ",c?.VITE_LIVEKIT_URL||n||"—"]})]})})}export{k as default};
