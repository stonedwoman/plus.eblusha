import{W as h}from"./index-BSnIWOU2.js";import"./vendor-query-CNP5Hy5J.js";import"./vendor-react-BcTlWpV0.js";import"./vendor-socket-CA1CrNgP.js";import"./vendor-crypto-GGjuBpPe.js";class w extends h{overlay=null;activeConversationId=null;async showIncomingCall(n){typeof document>"u"||(this.activeConversationId=n.conversationId,this.overlay||(this.overlay=this.createOverlayRoot()),this.overlay.style.display="flex",this.renderCard(n))}async closeIncomingCall(){this.overlay&&(this.overlay.style.display="none",this.overlay.innerHTML="",this.activeConversationId=null)}async ensurePermissions(){return{granted:!0}}async ensureBackgroundExecution(){return{granted:!0}}createOverlayRoot(){const n=document.createElement("div");return n.className="incoming-call-overlay",n.style.cssText=["position:fixed","inset:0","background:rgba(10,12,16,0.55)","backdrop-filter:blur(4px) saturate(110%)","display:flex","align-items:center","justify-content:center","z-index:2147483000","transition:opacity 0.2s ease","padding:24px 16px"].join(";"),n.addEventListener("click",e=>{e.target===n&&this.closeIncomingCall().catch(()=>{})}),document.body.appendChild(n),n}renderCard({callerName:n,isVideo:e,avatarUrl:t}){if(!this.overlay)return;this.overlay.innerHTML="";const i=document.createElement("div");i.style.cssText="background:var(--surface-200);border-radius:16px;border:1px solid var(--surface-border);padding:24px;width:min(92vw,440px);box-shadow:var(--shadow-sharp);transform:translateY(-4vh);color:var(--text-primary);display:flex;flex-direction:column;gap:16px",i.addEventListener("click",u=>u.stopPropagation());const r=document.createElement("div");r.style.fontWeight="700",r.style.marginBottom="4px",r.textContent=e?"Входящий видеозвонок":"Входящий аудиозвонок";const o=document.createElement("div");o.style.cssText="display:flex;align-items:center;gap:12px;padding:12px;background:var(--surface-100);border:1px solid var(--surface-border);border-radius:12px",o.appendChild(this.buildAvatar(n,t));const l=document.createElement("div"),d=document.createElement("div");d.style.fontWeight="600",d.style.fontSize="16px",d.textContent=n;const c=document.createElement("div");c.style.fontSize="12px",c.style.color="var(--text-muted)",c.textContent="звонит…",l.appendChild(d),l.appendChild(c),o.appendChild(l);const s=document.createElement("div");s.style.display="flex",s.style.flexDirection="column",s.style.gap="8px";const a=document.createElement("div");a.style.display="flex",a.style.gap="8px",a.appendChild(this.buildActionButton("Ответить","var(--brand, #2563eb)","#fff","accept-audio",this.phoneIcon())),a.appendChild(this.buildActionButton("Ответить с видео","var(--brand-strong, #0ea5e9)","#fff","accept-video",this.videoIcon()));const p=document.createElement("div");p.style.display="flex",p.appendChild(this.buildActionButton("Отмена","#ef4444","#fff","decline",this.phoneOffIcon())),s.appendChild(a),s.appendChild(p),i.appendChild(r),i.appendChild(o),i.appendChild(s),this.overlay.appendChild(i)}buildAvatar(n,e){const t=document.createElement("div");if(t.style.width="64px",t.style.height="64px",t.style.borderRadius="50%",t.style.overflow="hidden",t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center",t.style.background="var(--surface-300)",t.style.color="#fff",t.style.fontWeight="600",t.style.fontSize="20px",t.style.textTransform="uppercase",e){const i=document.createElement("img");return i.src=e,i.alt=n,i.style.width="100%",i.style.height="100%",i.style.objectFit="cover",t.appendChild(i),t}return t.textContent=this.buildInitials(n),t}buildInitials(n){const e=n.trim().split(/\s+/);return e.length===0?"?":e.length===1?e[0].charAt(0)||"?":`${e[0].charAt(0)}${e[1].charAt(0)}`.toUpperCase()}buildActionButton(n,e,t,i,r){const o=document.createElement("button");return o.type="button",o.style.cssText=["flex:1","display:inline-flex","align-items:center","justify-content:center","gap:8px","padding:14px 16px","min-height:48px","border-radius:12px","border:none","font-weight:600","font-size:15px",`background:${e}`,`color:${t}`,"cursor:pointer","transition:transform 0.15s ease, filter 0.15s ease"].join(";"),o.innerHTML=`${r}<span>${n}</span>`,o.onmouseenter=()=>{o.style.filter="brightness(1.05)"},o.onmouseleave=()=>{o.style.filter="none"},o.onmousedown=()=>{o.style.transform="translateY(1px)"},o.onmouseup=()=>{o.style.transform="translateY(0)"},o.onclick=l=>{l.stopPropagation(),this.dispatchAction(i)},o}dispatchAction(n){if(!this.activeConversationId||typeof window>"u")return;const e=this.activeConversationId,t=window;if(n==="decline"){typeof t.handleIncomingCallDecline=="function"?t.handleIncomingCallDecline(e):this.queueAction({action:"decline",conversationId:e}),this.closeIncomingCall();return}const i=n==="accept-video";typeof t.handleIncomingCallAnswer=="function"?t.handleIncomingCallAnswer(e,i):this.queueAction({action:"accept",conversationId:e,withVideo:i}),this.closeIncomingCall()}queueAction(n){if(typeof window>"u")return;const e=window;Array.isArray(e.__pendingCallActions)||(e.__pendingCallActions=[]),e.__pendingCallActions.push(n),typeof e.__flushNativeCallActions=="function"&&e.__flushNativeCallActions()}phoneIcon(){return'<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.44 12.44 0 0 0 .67 2.73 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.35-1.35a2 2 0 0 1 2.11-.45 12.44 12.44 0 0 0 2.73.67A2 2 0 0 1 22 16.92z"/></svg>'}videoIcon(){return'<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 7l-7 5 7 5V7z"/><rect x="1" y="5" width="15" height="14" rx="2" ry="2"/></svg>'}phoneOffIcon(){return'<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 3l2 2m2 2 8 8m-4 4-2 2M3 10l2 2m2 2 8 8m3.6-9.6a16 16 0 0 0-4.2-4.2m-2.8-1.5a16 16 0 0 0-5.6 5.6"/></svg>'}}export{w as IncomingCallWeb};
